#ejercicio 2 de monitores

Process Persona[i=1..N]{

    Banco.encolar(i)
    Timer[i].comenzar();
    Esperar[i].dormir();
    
    //cuando se levanta o lo atienden o se va
    /*Esperar[i].getEstado(estado);
    if(estado == "empleado"){
        //lo atienden 
        //sino nada
    }*/
    
}

Monitor Timer[i=1..N]{

    comenzar    = false;
    c           = cond;
    
    procedure comenzar(){   
        comenzar = true;
        signal(c);   
    }
    
    procedure empezar(){   
        if(!comenzar){
            wait(c);
        }  
    }
}

Process Timer[i=1..N]{

    Timer[i].empezar()
    delay(15);
    Esperar[i].setTimer();
    
}

Monitor Esperar[i=1..N]{

    c       = cond;
    estado  = "enCola";
    
    procedure setTimer(){
    
        //si no fue atendido por el empleado
        if(estado != "empleado"){
            estado = "timer";
        }
        //lo despierta
        signal(c);
    } 
    
    procedure setCajero(){
    
        if(estado != "timer"){
            estado = "empleado";
        }
        signal(c); 
    }
    
    procedure getEstadoP(estado){
        estado = estado;
    }
    
    procedure dormir(){
        wait(c);
    }
}

Process Empleado[i=1..2]{

    loop
        Banco.desencolar(id);
        Esperar[id].setCajero();
        Esperar[id].getEstadoP(estado)
        if(estado == "empleado"){
            //lo atiende
        }

}

Monitor Banco{

    cola    = queue;
    c       = cond;
    
    procedure encolar(i){
        cola.push(i);
        signal(c);
    }
    
    procedure desencolar(id){
        if(empty(cola)){
            wait(c);
        }
        id = cola.pop();
    }

}